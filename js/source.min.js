function GeolocationService(){this._location=new ymaps.util.Promise}GeolocationService.prototype={constructor:GeolocationService,getLocation:function(a){return navigator.geolocation?navigator.geolocation.getCurrentPosition(ymaps.util.bind(this._onGeolocationSuccess,this),ymaps.util.bind(this._onGeolocationError,this),a):this._location.resolve(this.getLocationByIP()||this.getDefaults()),this._sync()},_sync:function(){var a=new ymaps.util.Promise;return this._location.then(function(b){a.resolve(b)},function(b){a.reject(b)}),a},_onGeolocationSuccess:function(a){var b=[a.coords.latitude,a.coords.longitude],c=this._location,d={latitude:a.coords.latitude,longitude:a.coords.longitude,accuracy:a.coords.accuracy,altitude:a.coords.altitude,altitudeAccuracy:a.coords.altitudeAccuracy,speed:a.coords.speed,heading:a.coords.heading};this.getLocationData(b).then(function(a){c.resolve(ymaps.util.extend({isHighAccuracy:!0},d,a))},function(){c.resolve(ymaps.util.extend({},ymaps.geolocation,d,{isHighAccuracy:!0}))})},_onGeolocationError:function(a){window.console&&console.log(a.message||this.constructor.GEOLOCATION_ERRORS[a+1]),this._location.resolve(this.getLocationByIP()||this.getDefaults())},getLocationByIP:function(){return ymaps.geolocation},getLocationData:function(a){var b=new ymaps.util.Promise,c=this.getMapSize(),d=ymaps.geocode(a,{results:1,kind:"locality"});return d.then(function(a){var d=a.geoObjects.get(0),e=d.properties;d?b.resolve({zoom:ymaps.util.bounds.getCenterAndZoom(e.get("boundedBy"),c,ymaps.projection.wgs84Mercator).zoom,city:e.get("metaDataProperty.GeocoderMetaData.AddressDetails.Country.Locality.LocalityName",e.get("name")),country:e.get("metaDataProperty.GeocoderMetaData.AddressDetails.Country.CountryName",e.get("description")),region:e.get("metaDataProperty.GeocoderMetaData.AddressDetails.Country.AdministrativeArea.AdministrativeAreaName",e.get("metaDataProperty.GeocoderMetaData.text"))}):b.reject("Not found")},function(a){b.reject(a)}),b},getDefaults:function(){return{latitude:43.262734,longitude:76.927462,zoom:9,city:"Алматы",country:"Казахстан",region:"Алматы",isHighAccuracy:!1}},getMapSize:function(){return[800,600]}},GeolocationService.GEOLOCATION_ERRORS=["permission denied","position unavailable","timeout"];var init={map:function(){var a;ymaps.ready(function(){var b,c=(document.getElementById("YMapsID"),new GeolocationService),d=c.getLocation({enableHighAccuracy:!0,timeout:1e4,maximumAge:1e3});b=new ymaps.Map("YMapsID",{center:[43.26306,76.927571],zoom:17}),navigator.geolocation.getCurrentPosition(function(){}),ourOffice=new ymaps.Placemark([43.26306,76.927571],{iconContent:"Офис ChocoFamily"},{preset:"twirl#redStretchyIcon",balloonCloseButton:!1,hideIconOnBalloonOpen:!1}),b.geoObjects.add(ourOffice),b.controls.add(new ymaps.control.SmallZoomControl),document.getElementById("route").style.display="block",document.getElementById("route").onclick=function(){d.then(function(c){a=[c.latitude,c.longitude],ymaps.route([a,[43.26306,76.927571]],{mapStateAutoApply:!0,avoidTrafficJams:!0}).then(function(a){a.getPaths().options.set({balloonContenBodyLayout:ymaps.templateLayoutFactory.createClass("$[properties.humanJamsTime]"),strokeColor:"C0392B",opacity:.9}),b.geoObjects.add(a)})})}})}};init.map();