function GeolocationService(){this._location=new ymaps.util.Promise}function initMap(){var t;ymaps.ready(function(){var o,e=document.getElementById("YMapsID"),n=new GeolocationService,i=n.getLocation({enableHighAccuracy:!0,timeout:1e4,maximumAge:1e3});o=new ymaps.Map("YMapsID",{center:[43.26306,76.927571],zoom:17}),navigator.geolocation.getCurrentPosition(function(){}),ourOffice=new ymaps.Placemark([43.26306,76.927571],{iconContent:"Офис ChocoFamily"},{preset:"twirl#redStretchyIcon",balloonCloseButton:!1,hideIconOnBalloonOpen:!1}),o.geoObjects.add(ourOffice),o.controls.add(new ymaps.control.SmallZoomControl),n.getMapSize=function(){return[e.width(),e.height()]},document.getElementById("route").style.display="block",document.getElementById("route").onclick=function(){i.then(function(e){t=[e.latitude,e.longitude],ymaps.route([t,[43.26306,76.927571]],{mapStateAutoApply:!0,avoidTrafficJams:!0}).then(function(t){t.getPaths().options.set({balloonContenBodyLayout:ymaps.templateLayoutFactory.createClass("$[properties.humanJamsTime]"),strokeColor:"C0392B",opacity:.9}),o.geoObjects.add(t)})})}})}GeolocationService.prototype={constructor:GeolocationService,getLocation:function(t){return navigator.geolocation?navigator.geolocation.getCurrentPosition(ymaps.util.bind(this._onGeolocationSuccess,this),ymaps.util.bind(this._onGeolocationError,this),t):this._location.resolve(this.getLocationByIP()||this.getDefaults()),this._sync()},_sync:function(){var t=new ymaps.util.Promise;return this._location.then(function(o){t.resolve(o)},function(o){t.reject(o)}),t},_onGeolocationSuccess:function(t){var o=[t.coords.latitude,t.coords.longitude],e=this._location,n={latitude:t.coords.latitude,longitude:t.coords.longitude,accuracy:t.coords.accuracy,altitude:t.coords.altitude,altitudeAccuracy:t.coords.altitudeAccuracy,speed:t.coords.speed,heading:t.coords.heading};this.getLocationData(o).then(function(t){e.resolve(ymaps.util.extend({isHighAccuracy:!0},n,t))},function(){e.resolve(ymaps.util.extend({},ymaps.geolocation,n,{isHighAccuracy:!0}))})},_onGeolocationError:function(t){window.console&&console.log(t.message||this.constructor.GEOLOCATION_ERRORS[t+1]),this._location.resolve(this.getLocationByIP()||this.getDefaults())},getLocationByIP:function(){return ymaps.geolocation},getLocationData:function(t){var o=new ymaps.util.Promise,e=this.getMapSize(),n=ymaps.geocode(t,{results:1,kind:"locality"});return n.then(function(t){var n=t.geoObjects.get(0),i=n.properties;n?o.resolve({zoom:ymaps.util.bounds.getCenterAndZoom(i.get("boundedBy"),e,ymaps.projection.wgs84Mercator).zoom,city:i.get("metaDataProperty.GeocoderMetaData.AddressDetails.Country.Locality.LocalityName",i.get("name")),country:i.get("metaDataProperty.GeocoderMetaData.AddressDetails.Country.CountryName",i.get("description")),region:i.get("metaDataProperty.GeocoderMetaData.AddressDetails.Country.AdministrativeArea.AdministrativeAreaName",i.get("metaDataProperty.GeocoderMetaData.text"))}):o.reject("Not found")},function(t){o.reject(t)}),o},getDefaults:function(){return{latitude:43.262734,longitude:76.927462,zoom:9,city:"Алматы",country:"Казахстан",region:"Алматы",isHighAccuracy:!1}},getMapSize:function(){return[800,600]}},GeolocationService.GEOLOCATION_ERRORS=["permission denied","position unavailable","timeout"];